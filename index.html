<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œê¸€ ìˆ˜í™” í•™ìŠµ - ì†ê°€ë½ìœ¼ë¡œ ì´ë¦„ ë°°ìš°ê¸°</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #333; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; color: white; }
        .header h1 { font-size: 3em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .left-panel, .right-panel { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .video-container { position: relative; display: inline-block; margin-bottom: 20px; border-radius: 15px; overflow: hidden; box-shadow: 0 8px 25px rgba(0,0,0,0.15); border: 3px solid #e0e0e0; }
        #video { width: 100%; max-width: 500px; height: auto; background: #000; transform: scaleX(-1); }
        #canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; transform: scaleX(-1); }
        .controls { text-align: center; margin: 20px 0; }
        button { background: #3498db; border: none; color: white; padding: 15px 30px; margin: 0 10px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3); }
        button:hover { background: #2980b9; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; background: #bdc3c7; }
        .input-section { margin-bottom: 30px; }
        .input-section h3 { color: #2c3e50; margin-bottom: 15px; font-size: 1.5em; }
        .name-input { width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 18px; margin-bottom: 15px; text-align: center; }
        .name-input:focus { outline: none; border-color: #3498db; box-shadow: 0 0 10px rgba(52, 152, 219, 0.3); }
        /* [ì¶”ê°€] ì† ì„ íƒ ì˜µì…˜ ìŠ¤íƒ€ì¼ */
        .hand-option-section { margin-bottom: 20px; text-align: center; }
        .hand-option-section label { margin: 0 10px; font-size: 16px; cursor: pointer; }
        .hand-option-section input[type="radio"] { margin-right: 5px; }
        .decomposed-letters { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 20px 0; }
        .letter-card { background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; text-align: center; min-width: 60px; transition: all 0.3s ease; }
        .letter-card.current { background: #e3f2fd; border-color: #2196f3; transform: scale(1.1); box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3); }
        .letter-card.completed { background: #e8f5e8; border-color: #4caf50; }
        .letter-card h4 { font-size: 1.2em; margin-bottom: 5px; }
        .letter-card p { font-size: 0.9em; color: #666; }
        .learning-section { margin-top: 30px; }
        .current-letter { text-align: center; margin: 20px 0; }
        .current-letter h2 { font-size: 3em; color: #e74c3c; margin-bottom: 10px; }
        .current-letter p { font-size: 1.2em; color: #666; }
        .sign-guide { background: #f8f9fa; border-radius: 15px; padding: 20px; margin: 20px 0; border: 1px solid #e9ecef; }
        .sign-guide h4 { color: #2c3e50; margin-bottom: 15px; }
        .sign-guide ul { list-style: none; padding: 0; }
        .sign-guide li { padding: 8px 0; border-bottom: 1px solid #eee; }
        .sign-guide li:last-child { border-bottom: none; }
        .progress-section { background: #f8f9fa; border-radius: 15px; padding: 20px; margin: 20px 0; }
        .progress-bar { width: 100%; height: 20px; background: #e9ecef; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4caf50, #8bc34a); transition: width 0.3s ease; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: white; border-radius: 10px; padding: 15px; text-align: center; border: 1px solid #e9ecef; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .stat-card h4 { color: #2c3e50; margin-bottom: 5px; }
        .stat-card .number { font-size: 2em; font-weight: bold; color: #3498db; }
        .feedback-section { margin: 20px 0; text-align: center; height: 50px; }
        .feedback { padding: 15px; border-radius: 10px; font-size: 1.1em; font-weight: bold; margin: 10px 0; }
        .feedback.correct { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback.incorrect { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .gesture-status { background: #e3f2fd; color: #1565c0; border: 1px solid #bbdefb; padding: 10px; border-radius: 10px; margin: 10px 0; text-align: center; font-style: italic; }
        .sign-example { margin-top: 20px; text-align: center; }
        .sign-example h5 { color: #2c3e50; margin-bottom: 15px; font-size: 1.2em; }
        .sign-image { width: 200px; height: 200px; margin: 0 auto; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.5em; color: #888; position: relative; overflow: hidden; }
        .sign-image img { width: 100%; height: 100%; object-fit: contain; }
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 768px) {
            .main-content { grid-template-columns: 1fr; }
            .header h1 { font-size: 2em; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤š í•œê¸€ ìˆ˜í™” í•™ìŠµ</h1>
            <p>ì†ê°€ë½ìœ¼ë¡œ ë‚˜ì˜ ì´ë¦„ì„ ë°°ì›Œë³´ì„¸ìš”!</p>
        </div>

        <div class="main-content">
            <div class="left-panel">
                <h3>ğŸ“¹ ì‹¤ì‹œê°„ ìˆ˜í™” ì¸ì‹</h3>
                <div class="video-container">
                    <video id="video" autoplay muted playsinline></video>
                    <canvas id="canvas"></canvas>
                </div>
                <div class="controls">
                    <button id="startBtn">ì¹´ë©”ë¼ ì‹œì‘</button>
                    <button id="stopBtn" disabled>ì¹´ë©”ë¼ ì¤‘ì§€</button>
                    <button id="practiceBtn" disabled>ì—°ìŠµ ëª¨ë“œ</button>
                </div>
                <div class="feedback-section">
                    <div id="feedback" class="feedback hidden"></div>
                    <div id="gestureStatus" class="gesture-status hidden"><p>ì†ì„ ì¹´ë©”ë¼ ì•ì— ì˜¬ë ¤ì£¼ì„¸ìš”</p></div>
                </div>
                <div class="current-letter">
                    <h2 id="currentLetterDisplay">-</h2>
                    <p id="currentLetterName">í•™ìŠµí•  ìëª¨ìŒì„ ì„ íƒí•˜ì„¸ìš”</p>
                </div>
            </div>

            <div class="right-panel">
                <div class="input-section">
                    <h3>âœï¸ ì´ë¦„ ì…ë ¥</h3>
                    <input type="text" id="nameInput" class="name-input" placeholder="ì˜ˆ: ê¹€ì² ìˆ˜" maxlength="10">
                    <button id="analyzeBtn" disabled>ì´ë¦„ ë¶„ì„í•˜ê¸°</button>
                </div>

                <div class="hand-option-section">
                    <h3>ğŸ–ï¸ ì—°ìŠµí•  ì† ì„ íƒ</h3>
                    <label><input type="radio" name="hand" value="right" checked> ì˜¤ë¥¸ì†</label>
                    <label><input type="radio" name="hand" value="left"> ì™¼ì†</label>
                </div>

                <div id="decomposedSection" class="hidden">
                    <h3>ğŸ”¤ ìëª¨ìŒ ë¶„í•´</h3>
                    <div id="decomposedLetters" class="decomposed-letters"></div>
                </div>

                <div class="learning-section">
                    <h3>ğŸ“š í•™ìŠµ ì§„í–‰</h3>
                    <div class="progress-section">
                        <h4>ì „ì²´ ì§„í–‰ë¥ </h4>
                        <div class="progress-bar">
                            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <p id="progressText">0% ì™„ë£Œ</p>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h4>í•™ìŠµí•œ ìëª¨ìŒ</h4>
                            <div class="number" id="learnedCount">0</div>
                        </div>
                        <div class="stat-card">
                            <h4>ì •í™•ë„</h4>
                            <div class="number" id="accuracy">0%</div>
                        </div>
                        <div class="stat-card">
                            <h4>ì—°ìŠµ íšŸìˆ˜</h4>
                            <div class="number" id="practiceCount">0</div>
                        </div>
                    </div>
                    <div class="sign-guide">
                        <h4>ğŸ¯ í˜„ì¬ ìëª¨ìŒ ìˆ˜í™” ë°©ë²•</h4>
                        <div id="signInstructions">ì´ë¦„ì„ ì…ë ¥í•˜ê³  ë¶„ì„í•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
                        <div id="signExample" class="sign-example hidden">
                            <h5>ìˆ˜í™” ì˜ˆì‹œ</h5>
                            <div id="signImage" class="sign-image"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
<script>
    class KoreanSignLanguageLearner {
        constructor() {
            // (ì´ì „ ì½”ë“œì™€ ë™ì¼í•œ DOM ìš”ì†Œ ì„¤ì • ë¶€ë¶„... ìƒëµ)
            this.video = document.getElementById('video');
            this.canvas = document.getElementById('canvas');
            this.ctx = this.canvas.getContext('2d');
            this.startBtn = document.getElementById('startBtn');
            this.stopBtn = document.getElementById('stopBtn');
            this.practiceBtn = document.getElementById('practiceBtn');
            this.nameInput = document.getElementById('nameInput');
            this.analyzeBtn = document.getElementById('analyzeBtn');
            this.handOptionRadios = document.querySelectorAll('input[name="hand"]');

            this.hands = null;
            this.camera = null;
            this.isRunning = false;
            this.isPracticing = false;
            
            this.decomposedSyllables = [];
            this.currentSyllableIndex = 0;
            this.currentJamoTypeIndex = 0; 
            this.learnedLetters = new Set();
            this.practiceCount = 0;
            this.correctCount = 0;
            this.dominantHand = 'right';
            this.lastGestureTime = 0;
            this.gestureDebounceTime = 1000;
            
            this.signPatterns = this.initializeSignPatterns();
            
            this.initializeMediaPipe();
            this.setupEventListeners();
        }

        initializeSignPatterns() {
            // ì„¤ëª…ì„ ë°©í–¥ì— ë§ê²Œ ìˆ˜ì •
            return {
                'ã„±': { thumb: 'bent', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ê²€ì§€ë¥¼ êµ¬ë¶€ë ¤ ê°ˆê³ ë¦¬ ëª¨ì–‘ì„ ë§Œë“­ë‹ˆë‹¤.' },
                'ã„´': { thumb: 'bent', index: 'extended', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'ê²€ì§€ì™€ ì¤‘ì§€ë¥¼ í´ì„œ ë¶™ì…ë‹ˆë‹¤.' },
                'ã„·': { thumb: 'extended', index: 'extended', middle: 'extended', ring: 'extended', pinky: 'bent', description: 'ì—„ì§€ë¡œ ìƒˆë¼ì†ê°€ë½ì„ ëˆ„ë¥´ê³  ë‚˜ë¨¸ì§€ ì„¸ ì†ê°€ë½ì„ í…ë‹ˆë‹¤.' },
                'ã„¹': { thumb: 'extended', index: 'extended', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'ì—„ì§€, ê²€ì§€, ì¤‘ì§€ë¥¼ í´ê³  ë‚˜ë¨¸ì§€ëŠ” êµ¬ë¶€ë¦½ë‹ˆë‹¤.' },
                'ã…': { thumb: 'bent', index: 'extended', middle: 'extended', ring: 'extended', pinky: 'extended', description: 'ë„¤ ì†ê°€ë½ì„ ë¶™ì—¬ ì„¸ìš°ê³  ì—„ì§€ëŠ” ì†ë°”ë‹¥ì— ë¶™ì…ë‹ˆë‹¤.' },
                'ã…‚': { thumb: 'extended', index: 'extended', middle: 'extended', ring: 'extended', pinky: 'extended', description: 'ì†ë°”ë‹¥ì´ ì•ì„ í–¥í•˜ê²Œ í•˜ê³  ëª¨ë“  ì†ê°€ë½ì„ í…ë‹ˆë‹¤.' },
                'ã……': { thumb: 'bent', index: 'extended', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'ê²€ì§€ì™€ ì¤‘ì§€ë¥¼ êµì°¨ì‹œì¼œ í…ë‹ˆë‹¤. (ì¸ì‹ê¸°ëŠ” êµì°¨ë¥¼ ê°ì§€í•˜ì§€ ëª»í•˜ê³  ã„´ê³¼ ê°™ê²Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤)' },
                'ã…‡': { thumb: 'extended', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ì—„ì§€ì™€ ê²€ì§€ ëì„ ë¶™ì—¬ ë™ê·¸ë¼ë¯¸ë¥¼ ë§Œë“­ë‹ˆë‹¤.' },
                'ã…ˆ': { thumb: 'bent', index: 'extended', middle: 'extended', ring: 'extended', pinky: 'bent', description: 'ê²€ì§€, ì¤‘ì§€, ì•½ì§€ë¥¼ í´ê³  ë‚˜ë¨¸ì§€ëŠ” êµ¬ë¶€ë¦½ë‹ˆë‹¤.' },
                'ã…Š': { thumb: 'bent', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'extended', description: 'ìƒˆë¼ì†ê°€ë½ë§Œ í´ê³ (ã…£ ëª¨ì–‘) ìœ„ì•„ë˜ë¡œ ì›€ì§ì…ë‹ˆë‹¤. (ì •ì§€ ë™ì‘ì€ ã…£ì™€ ë™ì¼)' },
                'ã…‹': { thumb: 'extended', index: 'extended', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'ê²€ì§€ì™€ ì¤‘ì§€ë¥¼ í´ê³ (ã„´ ëª¨ì–‘), ì—„ì§€ ëì„ ì¤‘ì§€ ì²«ë§ˆë””ì— ëŒ‘ë‹ˆë‹¤.' },
                'ã…Œ': { thumb: 'bent', index: 'extended', middle: 'extended', ring: 'extended', pinky: 'extended', description: 'ë„¤ ì†ê°€ë½ì„ ë¶™ì—¬ í´ê³ (ã… ëª¨ì–‘) ì†ëª©ì„ ë¹„í‹‰ë‹ˆë‹¤. (ì •ì§€ ë™ì‘ì€ ã…ê³¼ ë™ì¼)' },
                'ã…': { thumb: 'extended', index: 'extended', middle: 'extended', ring: 'bent', pinky: 'extended', description: 'ê²€ì§€, ì¤‘ì§€, ìƒˆë¼ì†ê°€ë½ì„ í´ê³  ì—„ì§€ë¡œ ì•½ì§€ë¥¼ ëˆ„ë¦…ë‹ˆë‹¤.' },
                'ã…': { thumb: 'extended', index: 'extended', middle: 'extended', ring: 'extended', pinky: 'extended', description: 'ì†ë°”ë‹¥ì„ ì•„ë˜ë¡œ í–¥í•˜ê²Œ í´ê³ (ã…‚ ëª¨ì–‘) ì¢Œìš°ë¡œ í”ë“­ë‹ˆë‹¤. (ì •ì§€ ë™ì‘ì€ ã…‚ê³¼ ë™ì¼)' },
                'ã…': { thumb: 'extended', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ì—„ì§€ë¥¼ í´ê³  ë‚˜ë¨¸ì§€ëŠ” ì£¼ë¨¹ì„ ì¥¡ë‹ˆë‹¤.' },
                'ã…‘': { thumb: 'extended', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ã… ëª¨ì–‘ì—ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë‘ ë²ˆ ì§§ê²Œ ì›€ì§ì…ë‹ˆë‹¤. (ì •ì§€ ë™ì‘ì€ ã…ì™€ ë™ì¼)' },
                'ã…“': { thumb: 'bent', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ê²€ì§€ë¥¼ í´ê³ , ì†ë“±ì´ ì •ë©´ì„ í–¥í•˜ë„ë¡ ì†ì„ ì„¸ì›ë‹ˆë‹¤.' },
                'ã…•': { thumb: 'bent', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ã…“ ëª¨ì–‘ì—ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë‘ ë²ˆ ì§§ê²Œ ì›€ì§ì…ë‹ˆë‹¤. (ì •ì§€ ë™ì‘ì€ ã…“ì™€ ë™ì¼)' },
                'ã…—': { thumb: 'extended', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ì—„ì§€ì™€ ê²€ì§€ë¥¼ í´ì„œ ì§ê°(ã…—)ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.' },
                'ã…›': { thumb: 'extended', 'index': 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ã…— ëª¨ì–‘ì—ì„œ ìœ„ë¡œ ë‘ ë²ˆ ì§§ê²Œ ì›€ì§ì…ë‹ˆë‹¤. (ì •ì§€ ë™ì‘ì€ ã…—ì™€ ë™ì¼)' },
                'ã…œ': { thumb: 'bent', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ê²€ì§€ë¥¼ í´ì„œ ì•„ë˜ë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤. (ì†ë“±ì´ ìœ„ë¥¼ í–¥í•¨)' },
                'ã… ': { thumb: 'bent', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ã…œ ëª¨ì–‘ì—ì„œ ì•„ë˜ë¡œ ë‘ ë²ˆ ì§§ê²Œ ì›€ì§ì…ë‹ˆë‹¤. (ì •ì§€ ë™ì‘ì€ ã…œì™€ ë™ì¼)' },
                'ã…¡': { thumb: 'bent', 'index': 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ê²€ì§€ë¥¼ í´ì„œ ìˆ˜í‰ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤. (ì†ë“±ì´ ìœ„ë¥¼ í–¥í•˜ê³  ì†ëì´ ì™¼ìª½ì„ í–¥í•¨)' },
                'ã…£': { thumb: 'bent', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'extended', description: 'ìƒˆë¼ì†ê°€ë½ì„ í´ê³  ë‚˜ë¨¸ì§€ëŠ” ì£¼ë¨¹ì„ ì¥¡ë‹ˆë‹¤.' },
            };
        }

        // (ì´ì „ ì½”ë“œì™€ ë™ì¼í•œ í•¨ìˆ˜ë“¤... initializeMediaPipe, setupEventListeners, analyzeName ë“± ìƒëµ)
        async initializeMediaPipe() { this.hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` }); this.hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7, minTrackingConfidence: 0.7 }); this.hands.onResults((results) => this.onResults(results)); }
        setupEventListeners() { this.startBtn.addEventListener('click', () => this.startCamera()); this.stopBtn.addEventListener('click', () => this.stopCamera()); this.practiceBtn.addEventListener('click', () => this.togglePracticeMode()); this.nameInput.addEventListener('input', () => this.onNameInputChange()); this.analyzeBtn.addEventListener('click', () => this.analyzeName()); this.handOptionRadios.forEach(radio => { radio.addEventListener('change', (event) => { this.dominantHand = event.target.value; }); }); }
        onNameInputChange() { this.analyzeBtn.disabled = !this.nameInput.value.trim(); }
        analyzeName() { const name = this.nameInput.value.trim(); if (!name) return; this.decomposedSyllables = this.decomposeKoreanName(name); this.currentSyllableIndex = 0; this.currentJamoTypeIndex = 0; this.learnedLetters.clear(); this.practiceCount = 0; this.correctCount = 0; this.displayDecomposedLetters(); this.updateCurrentLetter(); this.updateProgress(); this.updateStats(); document.getElementById('decomposedSection').classList.remove('hidden'); this.practiceBtn.disabled = !this.isRunning; }
        decomposeKoreanName(name) { const syllables = []; const initials = ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…']; const medials = ['ã…', 'ã…', 'ã…‘', 'ã…’', 'ã…“', 'ã…”', 'ã…•', 'ã…–', 'ã…—', 'ã…˜', 'ã…™', 'ã…š', 'ã…›', 'ã…œ', 'ã…', 'ã…', 'ã…Ÿ', 'ã… ', 'ã…¡', 'ã…¢', 'ã…£']; const finals = ['', 'ã„±', 'ã„²', 'ã„³', 'ã„´', 'ã„µ', 'ã„¶', 'ã„·', 'ã„¹', 'ã„º', 'ã„»', 'ã„¼', 'ã„½', 'ã„¾', 'ã„¿', 'ã…€', 'ã…', 'ã…‚', 'ã…„', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…']; for (let i = 0; i < name.length; i++) { const code = name[i].charCodeAt(0); if (code >= 0xAC00 && code <= 0xD7A3) { const base = code - 0xAC00; const initial = Math.floor(base / 588); const medial = Math.floor((base % 588) / 28); const final = base % 28; const syllableJamos = [initials[initial], medials[medial]]; if (finals[final]) syllableJamos.push(finals[final]); syllables.push({ char: name[i], jamos: syllableJamos, decomposed: `${initials[initial]}${medials[medial]}${finals[final]}` }); } } return syllables; }
        displayDecomposedLetters() { const container = document.getElementById('decomposedLetters'); container.innerHTML = ''; this.decomposedSyllables.forEach((syllable, index) => { const card = document.createElement('div'); card.className = 'letter-card'; card.id = `syllable-${index}`; card.innerHTML = `<h4>${syllable.char}</h4><p>${syllable.decomposed}</p>`; container.appendChild(card); }); }
        updateCurrentLetter() { if (this.currentSyllableIndex >= this.decomposedSyllables.length) { document.getElementById('currentLetterDisplay').textContent = 'ì™„ë£Œ!'; document.getElementById('currentLetterName').textContent = 'ëª¨ë“  ìëª¨ìŒì„ í•™ìŠµí–ˆìŠµë‹ˆë‹¤!'; document.getElementById('signInstructions').textContent = 'ì¶•í•˜í•©ë‹ˆë‹¤! ì´ë¦„ì„ ëª¨ë‘ ì™„ì„±í–ˆì–´ìš”.'; this.hideSignExample(); return; } const currentSyllable = this.decomposedSyllables[this.currentSyllableIndex]; const currentJamo = currentSyllable.jamos[this.currentJamoTypeIndex]; const jamoTypes = ['ì´ˆì„±', 'ì¤‘ì„±', 'ì¢…ì„±']; document.getElementById('currentLetterDisplay').textContent = currentJamo; document.getElementById('currentLetterName').textContent = `${jamoTypes[this.currentJamoTypeIndex]}: ${currentJamo}`; this.updateSignInstructions(currentJamo); document.querySelectorAll('.letter-card').forEach(card => card.classList.remove('current')); document.getElementById(`syllable-${this.currentSyllableIndex}`).classList.add('current'); }
        updateSignInstructions(letter) { const pattern = this.signPatterns[letter]; if (pattern) { document.getElementById('signInstructions').innerHTML = `<ul><li>${pattern.description}</li></ul>`; this.showSignExample(letter); } else { document.getElementById('signInstructions').innerHTML = 'ì´ ìëª¨ìŒì˜ ìˆ˜í™” íŒ¨í„´ì´ ì—†ìŠµë‹ˆë‹¤. ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.'; this.hideSignExample(); setTimeout(() => this.nextJamo(), 1500); } }
        showSignExample(letter) { const signExample = document.getElementById('signExample'); const signImage = document.getElementById('signImage'); signImage.innerHTML = `<span>ì´ë¯¸ì§€ ì¤€ë¹„ ì¤‘</span>`; signExample.classList.remove('hidden'); signExample.classList.add('fade-in'); }
        hideSignExample() { document.getElementById('signExample').classList.add('hidden'); }
        async startCamera() { try { this.startBtn.disabled = true; this.camera = new Camera(this.video, { onFrame: async () => { if (this.hands) await this.hands.send({ image: this.video }); }, width: 500, height: 400 }); await this.camera.start(); this.isRunning = true; this.stopBtn.disabled = false; if (this.decomposedSyllables.length > 0) this.practiceBtn.disabled = false; } catch (error) { console.error('ì¹´ë©”ë¼ ì‹œì‘ ì˜¤ë¥˜:', error); this.startBtn.disabled = false; } }
        stopCamera() { if (this.camera) { this.camera.stop(); this.camera = null; } this.isRunning = false; this.isPracticing = false; this.startBtn.disabled = false; this.stopBtn.disabled = true; this.practiceBtn.disabled = true; this.practiceBtn.textContent = 'ì—°ìŠµ ëª¨ë“œ'; this.practiceBtn.style.background = '#3498db'; this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height); this.hideFeedback(); }
        togglePracticeMode() { this.isPracticing = !this.isPracticing; this.practiceBtn.textContent = this.isPracticing ? 'ì—°ìŠµ ì¤‘ì§€' : 'ì—°ìŠµ ì‹œì‘'; this.practiceBtn.style.background = this.isPracticing ? '#e74c3c' : '#2980b9'; document.getElementById('gestureStatus').classList.toggle('hidden', !this.isPracticing); if (!this.isPracticing) this.hideFeedback(); }
        showFeedback(message, type) { const feedback = document.getElementById('feedback'); feedback.textContent = message; feedback.className = `feedback ${type} fade-in`; feedback.classList.remove('hidden'); }
        hideFeedback() { document.getElementById('feedback').classList.add('hidden'); }
        nextJamo() { const currentSyllable = this.decomposedSyllables[this.currentSyllableIndex]; if (this.currentJamoTypeIndex >= currentSyllable.jamos.length - 1) { document.getElementById(`syllable-${this.currentSyllableIndex}`).classList.add('completed'); this.currentSyllableIndex++; this.currentJamoTypeIndex = 0; } else { this.currentJamoTypeIndex++; } this.updateCurrentLetter(); this.updateProgress(); this.hideFeedback(); }
        updateProgress() { let learnedJamos = 0; for(let i=0; i < this.currentSyllableIndex; i++) learnedJamos += this.decomposedSyllables[i].jamos.length; learnedJamos += this.currentJamoTypeIndex; let totalJamos = this.decomposedSyllables.reduce((sum, s) => sum + s.jamos.length, 0); const progress = totalJamos > 0 ? (learnedJamos / totalJamos) * 100 : 0; document.getElementById('progressFill').style.width = `${progress}%`; document.getElementById('progressText').textContent = `${Math.round(progress)}% ì™„ë£Œ`; }
        updateStats() { document.getElementById('learnedCount').textContent = this.learnedLetters.size; const accuracy = this.practiceCount > 0 ? (this.correctCount / this.practiceCount) * 100 : 0; document.getElementById('accuracy').textContent = `${Math.round(accuracy)}%`; document.getElementById('practiceCount').textContent = this.practiceCount; }
        
        // ===================================================================
        // [ì‹ ê·œ ì¶”ê°€] ì†ë°”ë‹¥ ë°©í–¥ ê³„ì‚° í•¨ìˆ˜
        // ===================================================================
        calculatePalmNormal(landmarks) {
            const p0 = landmarks[0]; // Wrist
            const p5 = landmarks[5]; // Index finger MCP
            const p17 = landmarks[17]; // Pinky MCP

            // Create two vectors on the plane of the palm
            const v1 = { x: p5.x - p0.x, y: p5.y - p0.y, z: p5.z - p0.z };
            const v2 = { x: p17.x - p0.x, y: p17.y - p0.y, z: p17.z - p0.z };

            // Calculate the cross product to get the normal vector
            const normal = {
                x: v1.y * v2.z - v1.z * v2.y,
                y: v1.z * v2.x - v1.x * v2.z,
                z: v1.x * v2.y - v1.y * v2.x
            };

            // Normalize the vector (make its length 1)
            const magnitude = Math.sqrt(normal.x * normal.x + normal.y * normal.y + normal.z * normal.z);
            normal.x /= magnitude;
            normal.y /= magnitude;
            normal.z /= magnitude;

            return normal;
        }

        onResults(results) {
            this.canvas.width = this.video.videoWidth;
            this.canvas.height = this.video.videoHeight;
            this.ctx.save();
            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];
                drawConnectors(this.ctx, landmarks, HAND_CONNECTIONS, { color: '#00FF00', lineWidth: 5 });
                drawLandmarks(this.ctx, landmarks, { color: '#FF0000', lineWidth: 2 });
                
                if (this.isPracticing && this.decomposedSyllables.length > 0) {
                    const now = Date.now();
                    if (now - this.lastGestureTime > this.gestureDebounceTime) {
                        this.processGesture(landmarks);
                        this.lastGestureTime = now;
                    }
                }
                document.getElementById('gestureStatus').textContent = 'ì† ëª¨ì–‘ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”!';
            } else if(this.isPracticing) {
                document.getElementById('gestureStatus').textContent = 'ì¹´ë©”ë¼ì— ì†ì´ ë³´ì´ë„ë¡ í•´ì£¼ì„¸ìš”.';
            }
            this.ctx.restore();
        }
        
        processGesture(landmarks) {
            if (this.currentSyllableIndex >= this.decomposedSyllables.length) return;

            const currentJamo = this.decomposedSyllables[this.currentSyllableIndex].jamos[this.currentJamoTypeIndex];
            const targetPattern = this.signPatterns[currentJamo];
            if (!targetPattern) return;

            const currentPattern = this.analyzeHandPattern(landmarks);
            
            // 1. ê¸°ë³¸ ì† ëª¨ì–‘ì´ ë§ëŠ”ì§€ ë¨¼ì € í™•ì¸
            let isShapeCorrect = Object.keys(targetPattern).every(finger => 
                finger === 'description' || targetPattern[finger] === currentPattern[finger]
            );

            // ===================================================================
            // [ìˆ˜ì •] ë°©í–¥ì´ ì¤‘ìš”í•œ ìëª¨ìŒì— ëŒ€í•´ ì¶”ê°€ ì¡°ê±´ í™•ì¸
            // ===================================================================
            if (isShapeCorrect) {
                const normal = this.calculatePalmNormal(landmarks);
                const threshold = 0.6; // ë°©í–¥ ì¼ì¹˜ ì„ê³„ê°’ (í´ìˆ˜ë¡ ì—„ê²©)

                // ì˜¤ë¥¸ì† ê¸°ì¤€: ì†ë“±ì´ ì •ë©´(zì¶• ìŒìˆ˜), ì†ëì´ ì™¼ìª½(xì¶• ìŒìˆ˜)
                // ì™¼ì† ê¸°ì¤€: ì†ë“±ì´ ì •ë©´(zì¶• ìŒìˆ˜), ì†ëì´ ì˜¤ë¥¸ìª½(xì¶• ì–‘ìˆ˜)
                const isFacingForward = (this.dominantHand === 'right') ? (normal.x < -threshold) : (normal.x > threshold);
                
                // ì˜¤ë¥¸ì†/ì™¼ì† ëª¨ë‘: ì†ë“±ì´ ìœ„(yì¶• ìŒìˆ˜), ì†ë°”ë‹¥ì´ ì•„ë˜(yì¶• ì–‘ìˆ˜)
                const isFacingDown = normal.y > threshold; 

                if (currentJamo === 'ã…“' && !isFacingForward) {
                    isShapeCorrect = false;
                } else if (currentJamo === 'ã…œ' && !isFacingDown) {
                    isShapeCorrect = false;
                } else if (currentJamo === 'ã…¡' && !isFacingDown) { // ã…¡ë„ ì†ë“±ì´ ìœ„ë¥¼ í–¥í•¨
                    isShapeCorrect = false;
                }
            }
            // ===================================================================

            this.practiceCount++;
            if (isShapeCorrect) {
                this.showFeedback('ì •í™•í•©ë‹ˆë‹¤! ğŸ‘', 'correct');
                this.learnedLetters.add(currentJamo);
                this.correctCount++;
                setTimeout(() => { this.nextJamo(); }, 1500);
            } else {
                this.showFeedback('ëª¨ì–‘ì´ë‚˜ ë°©í–¥ì´ ë‹¬ë¼ìš”. ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”.', 'incorrect');
            }
            this.updateStats();
        }

        analyzeHandPattern(landmarks) {
            return {
                thumb: this.getThumbState(landmarks),
                index: this.getFingerState(landmarks, 8, 6),
                middle: this.getFingerState(landmarks, 12, 10),
                ring: this.getFingerState(landmarks, 16, 14),
                pinky: this.getFingerState(landmarks, 20, 18)
            };
        }

        getFingerState(landmarks, tipIndex, dipIndex) {
            return landmarks[tipIndex].y < landmarks[dipIndex].y ? 'extended' : 'bent';
        }

        getThumbState(landmarks) {
            if (this.dominantHand === 'right') {
                return landmarks[4].x < landmarks[3].x ? 'extended' : 'bent';
            } else {
                return landmarks[4].x > landmarks[3].x ? 'extended' : 'bent';
            }
        }
    }
    
    document.addEventListener('DOMContentLoaded', () => new KoreanSignLanguageLearner());
</script>
</body>
</html>